<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Chat with AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .typing::after {
        content: "...";
        animation: dots 1.2s steps(3, end) infinite;
      }
      @keyframes dots {
        0% { content: "."; }
        33% { content: ".."; }
        66% { content: "..."; }
        100% { content: ""; }
      }
    </style>
  </head>
  <body class="bg-black text-white min-h-screen flex flex-col justify-between">
    <div class="flex-1 p-4 overflow-y-auto space-y-4" id="chatContainer"></div>

    <div class="p-4 bg-gray-900">
      <div class="flex">
        <input
          id="userInput"
          type="text"
          placeholder="Ask anything"
          class="flex-1 px-4 py-2 rounded-l bg-gray-800 border border-gray-700 text-white"
        />
        <button
          onclick="sendMessage()"
          class="bg-blue-600 px-4 py-2 rounded-r hover:bg-blue-700"
        >
          Send
        </button>
      </div>
    </div>

    <script>
      const chatContainer = document.getElementById("chatContainer");

      function appendMessage(text, isUser = false, isTyping = false) {
        const msg = document.createElement("div");
        msg.className = `whitespace-pre-wrap text-base ${
          isUser ? "text-right text-blue-400" : "text-left text-gray-200"
        }`;
        msg.innerHTML = `<span class="${isTyping ? 'typing' : ''}">${text}</span>`;

        chatContainer.appendChild(msg);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        if (!isUser && !isTyping) {
          const copyBtn = document.createElement("button");
          copyBtn.textContent = "ðŸ“‹";
          copyBtn.className = "ml-2 text-xs underline hover:text-green-400";
          copyBtn.onclick = () => navigator.clipboard.writeText(text);
          msg.appendChild(copyBtn);
        }
      }

      async function sendMessage() {
        const input = document.getElementById("userInput");
        const userMsg = input.value.trim();
        if (!userMsg) return;

        appendMessage(userMsg, true);
        input.value = "";

        appendMessage("Typing", false, true);

        try {
          const res = await fetch("https://practice-tvk1.onrender.com/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: userMsg }),
          });

          const data = await res.json();

          chatContainer.removeChild(chatContainer.lastChild);
          appendMessage(data.message);
        } catch (err) {
          chatContainer.removeChild(chatContainer.lastChild);
          appendMessage("Error: Unable to connect.");
        }
      }
    </script>
  </body>
</html>
